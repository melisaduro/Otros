use [FY1718_VOICE_SEVILLA_4G_H1]

--select min(t.starttime),max(t.starttime)
--from sessions T, filelist f
--where T.fileid=f.fileid
--and t.valid=1

select sum(attemps),SUM(fails),sum(drops), mnc
from (
select sum(1) as attemps,SUM(CASE WHEN info='Failed' THEN 1 ELSE 0 END) AS FAILS,SUM(CASE WHEN info='Dropped' THEN 1 ELSE 0 END) AS DROPS,RIGHT(LEFT(IMSI,5),2) as mnc
from sessions s, filelist f
where f.fileid=s.FileId
and s.valid=1
and sessiontype='CALL'
and info in ('Completed','Failed','Dropped')
AND COLLECTIONNAME LIKE '%sevilla%4G%'
group by imsi) t
group by mnc
ORDER BY case mnc WHEN '01' THEN 1 WHEN '07' THEN 2 WHEN '03' THEN 3 WHEN '04' THEN 4 end


select sum(attemps),SUM(fails),sum(drops), mnc
from (
select sum(1) as attemps,SUM(CASE WHEN info='Failed' THEN 1 ELSE 0 END) AS FAILS,SUM(CASE WHEN info='Dropped' THEN 1 ELSE 0 END) AS DROPS,RIGHT(LEFT(IMSI,5),2) as mnc
from sessions s, filelist f
where f.fileid=s.FileId
and s.valid=1
and sessiontype='CALL'
and info in ('Completed','Failed','Dropped')
AND COLLECTIONNAME LIKE '%sevilla%volte%'
group by imsi) t
group by mnc
ORDER BY case mnc WHEN '01' THEN 1 WHEN '07' THEN 2 WHEN '03' THEN 3 WHEN '04' THEN 4 end


--select S.SESSIONID
--from sessions s, filelist f
--where s.fileid=f.fileid
--AND COLLECTIONNAME LIKE '%MALAGA%4G%'
--and s.valid=1
--and sessiontype='CALL'
--and info in ('Completed','Failed','Dropped')

--UPDATE SESSIONS 
--SET VALID=1,InvalidReason=''
--WHERE SESSIONID IN ('57438','52458','48639','48307','47835','115254','48021','48685','48353','101051','83641','47789','48115','105553','96660','48067','76199','108161','83355','84019','69701','47743','48407','50228','101500','109541','100295','98844','85393','75266','48313','84265','102087','68828','56150','84869','119150','47783','48127','94994','102227','103206','48075','87030','66421','48699','90746','93757','47823','48081','76139','48413','60060','48107','103744','47795','114464','48387','105161','84013','62551','48087','53989','102015','48015','48679','48605','92649','59697','47815','47803','95864','48599','77023','59711','48393','48399','98712','73477','48101','48691','52478','114742','101660','106578','86561','48711','48379','47809','60830','68324','78380','61400','96024','88791','47763','48095','113359','109277','105293','87440','72661','51530','70099','120143','110872','83521','92349','48333','73047','115566','48705','48373','85001','61108','48135','107577','97415','48659','48573','48327','105857','58901','57564','113777','100547','101580','48619','54121','57026','57424','54762','59041','116190','90173','69080','65144','48419','50388','100799','101881','48035','48367','90414','63023','54510','47749','117664','47775','101420','106326','48625','65937','57430','107208','68576','58489','109933','47769','59179','119771','107869','77155','48041','115878','48645','95306','74470','47849','113863','76485','48055','85525','120641','70869','47755','53414','100773','47855','48347','50466','51130','47833','106954','63748','105033','47787','91448','48305','48311','73443','57436','48405','107695','48113','48359','59597','72261','84017','68448','47827','102966','48019','70987','55644','52550','98243','48079','48073','91402','101538','83633','47781','48027','63616','48391','110406','47821','48319','75000','92049','48697','55152','85265','96340','57708','48577','74053','48411','97691','102726','48013','48677','48603','76394','48703','94688','110500','65697','50306','48385','57290','53354','48683','48597','101458','99786','63490','47807','47801','120393','114648','91236','113609','99202','76380','48047','64956','105817','48663','48331','97279','47761','48093','48425','101618','67326','61398','99108','103324','68700','83765','56274','47767','60828','113695','114190','84137','88511','48657','69965','48325','92779','48671','48623','48611','60316','89931','48571','92195','94894','87572','50586','74488','120519','74734','48617','55896','48371','48059','68952','78106','48651','72461','98976','73623','47847','48033','48365','76755','56148','48133','48631','75779','65208','47747','105683','91076','88371','47841','72063','101698','107867','75899','48039','48053','87254','97831','70867','66539','61678','48339','48351','101947','47861','106928','118830','54894','48637','48643','106828','59457','66055','76426','47853','48345','82969','87546','84741','89069','48071','48403','117580','95098','75130','108449','92797','47785','57440','119787','76412','53172','103780','114832','56962','67782','120019','113527','100199','57434','48357','72359','88343','48077','48065','48409','47839','48031','64264','48363','47825','96180','48317','77291','92047','86385','47779','48025','67504','104636','96816','48125','93521','107086','74786','48011','48675','53538','48105','74998','47799','71111','48389','47819','47991','48111','48701','69923','47793','119893','101819','84015','48397','48681','65815','48695','108303','52668','48303','73189','88927','89611','48097','48595','48689','56020','47805','58625','75396','77952','53478','96498','88789','47859','78662','110962','52436','58765','64006','48045','48709','60832','110776','77812','63488','47813','56896','61396','47765','48091','76887','66946','48283','107719','48383','48575','60966','86033','110590','48669','48609','61250','117268','118510','48323','48417','48423','69571','61112','48615','48369','114374','59043','51666','110684','47845','48343','87166','116644','113441','47773','57428','55768','48131','93993','62787','48655','48649','89771','72559','107865','93873','47865','63754','48629','71351','48337','85131','70487','55276','50862','73335','48635','93097','54892','47759','47753','61676','116956','48051','104364','95708','103446','48023','48687','48355','97967','53857','48069','48401','110702','90095','47837','98107','103686','47791','71595','48309','57824','109013','92045','83887','48017','48029','48361','76015','70359','52262','48315','75955','47831','60572','47777','50144','48123','103208','105421','83781','48083','48415','61814','66177','104502','102295','47797','73765','53725','100423','48009','48673','56404','105945','87708','90536','67224','59321','48109','48601','48607','107084','114558','77423','47817','99802','48089','84385','70227','48693','51398','69835','48301','61534','100927','118190','86898','92949','48103','54638','94229','99590','88235','110316','99398','48395','110708','114758','47857','50064','109803','78096','64768','47811','89689','48335','48329','76075','48381','104230','64860','100171','48421','85653','48621','48707','48375','52202','114280','65332','48661','48667','100941','60080','48613','97555','48713','53290','61110','48321','97601','73699','47751','53230','54890','120271','48129','102155','48057','57426','47843','47771','76444','120535','73911','48037','48627','50548','91074','92497','48063','48653','57432','103958','65424','47745','47757','57160','86211','47851','47863','54386','48349','113945','76487','74864','48043','48633','48647','61680','62315','48341','64130','48049','53118','48641','57838','100675','70871')
--AND VALID=0

--UPDATE SESSIONS 
--SET VALID=1,InvalidReason=''
--WHERE SESSIONID IN ('15652','11739','4128','9409','12077','12409','1506','9429','16574','2310','15392','9157','1638','4394','9074','962','2436','10185','8164','12741','10285','2946','17659','10769','522','10933','8494','8820','7661','9112','8926','8388','2692','10609','350','1238','9098','11093','9905','7057','16042','694','9693','2566','9985','6757','2180','9064','1098','7361','4662','9551','9036','10055','8274','826','11569','14154','2054','1370','1774','3448','2','10083','14460','9225','9177','15136','16310','9217','13848','16842','10233','9165','1912','10445','12577','11913','8710','8604','3194','9835','17787','13542','9205','9088','9122','3864','15912','9048','180','9185','7133','1076','12245','9197')
--AND VALID=0

--SELECT VALID,COUNT(1)
--FROM SESSIONS
--WHERE SESSIONID IN ('15652','11739','4128','9409','12077','12409','1506','9429','16574','2310','15392','9157','1638','4394','9074','962','2436','10185','8164','12741','10285','2946','17659','10769','522','10933','8494','8820','7661','9112','8926','8388','2692','10609','350','1238','9098','11093','9905','7057','16042','694','9693','2566','9985','6757','2180','9064','1098','7361','4662','9551','9036','10055','8274','826','11569','14154','2054','1370','1774','3448','2','10083','14460','9225','9177','15136','16310','9217','13848','16842','10233','9165','1912','10445','12577','11913','8710','8604','3194','9835','17787','13542','9205','9088','9122','3864','15912','9048','180','9185','7133','1076','12245','9197')
--GROUP BY VALID

--UPDATE SESSIONS 
--SET VALID=0,InvalidReason='LCC OutOfBounds - ORA'
--WHERE SESSIONID IN (
--'19030',
--'19294',
--'19522'

--)
